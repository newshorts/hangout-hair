<?xml version="1.0" encoding="UTF-8"?>
        <!-- Copyright 2012 Google Inc. All Rights Reserved -->
        <Module>
          <ModulePrefs title="Hangout Hair" height="200" width="550">
          <Require feature="dynamic-height"/>
          <Require feature="rpc"/>
          <Require feature="views" />
        </ModulePrefs>
        <Content type="html"><![CDATA[
<!DOCTYPE html>
          
<style type="text/css">
<!--
#wrap {
    background-color: #fbfbfb;
}

-->
</style>

<script src="https://hangoutsapi.talkgadget.google.com/hangouts/_/api/hangout.js?v=1.1" ></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="https://s3.amazonaws.com/newe1344-gsp/google/hangouts/hangout-hair/app.js"></script>

<div id='wrap'>
    <canvas id="canvas">
        Unfortunately you don't have a browser that supports the canvas tag! Click <a href="http://www.mozilla.org/en-US/firefox/new/">here</a> to get one!
    </canvas>
</div>
<script>

/** Standard requestAnimFrame from paulirish.com, running 30 fps */
window.requestAnimFrame = (function (callback) {
    return window.requestAnimationFrame ||
    window.webkitRequestAnimationFrame ||
    window.mozRequestAnimationFrame ||
    window.oRequestAnimationFrame ||
    window.msRequestAnimationFrame ||
    function(callback){
        window.setTimeout(callback, 1000 / 30);
    };
})();

var app = new App(canvas);

function doSomething(evt) {
    app.changeHeadPos(evt);
}

function init() {
    var width = 640;
    var height = 380;

    $('#canvas').attr({
        'width': width,
        'height': height
    });

    $('#canvas').css({
        width: width,
        height: height,
        position: 'fixed',
        top: 0,
        'margin-left': '50%',
        left: '-320px',
        'z-index': 9999999999
    });
    
    $('object').css({
        'z-index': -1
    });

    var canvas = document.getElementById('canvas');

    app.init();
    
    // When API is ready...                                                
    gapi.hangout.onApiReady.add(function(eventObj) {
        if (eventObj.isApiReady) {
            gapi.hangout.av.effects.onFaceTrackingDataChanged.add(doSomething);
            
            // NOTE: Google does not allow you to overlay a canvas on top of this video feed, need help from google
            var feed = gapi.hangout.layout.getDefaultVideoFeed();
            var canvas = gapi.hangout.layout.getVideoCanvas();
            canvas.setVideoFeed(feed);
            canvas.setWidth(600);
            canvas.setPosition(300, 50);
            canvas.setVisible(true);
        }
    });
}

// Wait for gadget to load.                                         
gadgets.util.registerOnLoadHandler(init); 
</script>
<br/>
]]></Content></Module>